<!DOCTYPE html>
<html>
    <head>
        <title>Choice Commitment Task</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-custom/custom-jspsych-four-image-keyboard-response.js"></script>
        <script src="jspsych-custom/custom-jspsych-two-image-keyboard-response.js"></script>
        <link href="jspsych.6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

        var timeline = [];

        var welcome = {
            type: "html-button-response",
            stimulus: 'Welcome to the experiment.',
            choices: ['Begin']
        }

        var instructions1 = {
            type: "html-keyboard-response",
            stimulus: "<p>Phase 1</p><p>In this experiment, you will see 2 shapes (either a circle, square, " +
            " diamond, triangle) appear on the screen randomly paired.</p><p>You must " +
            "choose only <strong>1</strong> of the 2 shapes displayed on the screen during each " +
            "trial.</p><p>Only <strong>1</strong> of the 2 shapes will lead to  " +
            "a positive outcome (a point being awarded).</p><p>Your goal is to " +
            "accumulate as many points as possible by the end of the trials.</p><p>If you " +
            "choose the shape on the <strong>left</strong> side of the screen, press <strong>'a'</strong> " +
            "on the keyboard.</p><p>If you choose the shape on the <strong>right</strong> side of the " +
            "screen, press the letter <strong>'s'</strong> on the keyboard.</p>" +
            "<p>Press any key to begin.</p>",
        };

        var phase1_trial = {
            type: "2image-keyboard-response",
            choices: ['a', 's'],
            timeline: [
                {
                    type: 'html-keyboard-response',
                    stimulus: '<div style="font-size:60px;">+</div',
                    choices: jsPsych.NO_KEYS,
                    trial_duration: 1000
                },
                {
                    type: '2image-keyboard-response',
                    stimulus: jsPsych.timelineVariable('stimulus'),
                    choices: ['a', 's']
                },
                {
                    type: "2image-keyboard-response",
                    stimulus1: 'img/Circle.png', 
                    stimulus2: 'img/Triangle.png',
                    choices: ['a', 's'],
                },
                {
                    type: "2image-keyboard-response",
                    stimulus1: 'img/Triangle.png', 
                    stimulus2: 'img/Diamond.png',
                    choices: ['a', 's']
                },
                {
                    type: "2image-keyboard-response",
                    stimulus1: 'img/Square.png', 
                    stimulus2: 'img/Diamond.png',
                    choices: ['a', 's']
                },
                {
                    type: "2image-keyboard-response",
                    stimulus1: 'img/Diamond.png', 
                    stimulus2: 'img/Circle.png',
                    choices: ['a', 's']
                },
                {
                    type: "2image-keyboard-response",
                    stimulus1: 'img/Triangle.png', 
                    stimulus2: 'img/Square.png',
                    choices: ['a', 's']
                },
                {
                    type: "2image-keyboard-response",
                    stimulus1: 'img/Circle.png', 
                    stimulus2: 'img/Square.png',
                    choices: ['a', 's']
                },
            ],
            timeline_variables: [
                {stimulus: 'img/Circle.png'},
                {stimulus: 'img/Triangle.png'},
                {stimulus: 'img/Diamond.png'},
                {stimulus: 'img/Square.png'}
            ],
            randomize_order: true,
            sample: {
                type: 'without-replacement',
                size: 1,
            }


        }

        var trial_p1_1 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Circle.png', 
            stimulus2: 'img/Triangle.png',
            choices: ['a', 's'],
            showchoice: true
        };

        var trial_p1_2 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Triangle.png', 
            stimulus2: 'img/Diamond.png', 
            choices: ['a', 's'],
            showchoice: true
        };

        var trial_p1_3 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Square.png', 
            stimulus2: 'img/Diamond.png',
            choices: ['a', 's'],
            showchoice: true
        };

        var trial_p1_4 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Diamond.png', 
            stimulus2: 'img/Circle.png',
            choices: ['a', 's'],
            showchoice: true
        };

        var trial_p1_5 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Triangle.png', 
            stimulus2: 'img/Square.png',
            choices: ['a', 's'],
            showchoice: true
        };

        var trial_p1_6 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Circle.png', 
            stimulus2: 'img/Square.png',
            choices: ['a', 's'],
            showchoice: true
        }

        var fixation = {
            type: "html-keyboard-response",
            stimulus: '<div style="font-size:60px;">+</div',
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000,
        }

        var point_accumulation1 = {
            type: "html-keyboard-response",
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000,
            stimulus: function() {

                var trials = jsPsych.data.get().filter({test_part: 'test'});
                var correct_trials = trials.filter({correct: true});
                var accuracy = Math.floor(Math.random()* 2);
                
                return "<p>"+accuracy+" point</p>";
            },
        }

        var point_accumulation2 = {
            type: "html-keyboard-response",
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000,
            stimulus: function() {

                var trials = jsPsych.data.get().filter({test_part: 'random'});
                var correct_trials = trials.filter({correct: true});
                var accuracy = Math.round(correct_trials.count());

                return "<p>"+accuracy+" total points</p>";
            },
        }

        var debrief_block1 = {
            type: "html-keyboard-response",
            stimulus: function() {

                var trials = jsPsych.data.get().filter({test_part: 'test'});
                var correct_trials = trials.filter({correct: true});
                var accuracy = Math.round(correct_trials.count() / trials.count() * 100);

                return "<p>You responded correctly on "+accuracy+"% of the trials.</p>"+
                "<p>Press any key to continue.</p>";         
            }
        }

        var choice_question = {
            type: "html-keyboard-response",
            stimulus: "<p>Choose your preferred shape</p>" +
            "<div style='width: 700px;'>" +
            "<div style='float: left;'><img src='img/Shapes.png'></img>" +
            "</div>"+
            "<p>If you choose <strong>circle</strong>, press the letter 'a' on the keyboard.</p><p>If " +
            "you choose <strong>square</strong>, press the letter 's' on the keyboard.</p><p>If " +
            "you choose <strong>diamond</strong>, press the letter 'd' on the keyboard.</p><p>If " +
            "you choose <strong>triangle</strong>, press the letter 'f' on the keyboard.</p>",
            choices: ['a', 's', 'd', 'f']
        }

        var question_block = {
            type: "html-button-response",
            stimulus: "How confident do you feel about your preferred choice of shape on a scale " +
            "of 1-10, with 1 being the least confident and 10 being the most confident?",
            choices: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10']
        }

        var instructions2 = {
            type: "html-keyboard-response",
            stimulus: "<p>Phase 2</p><p>In this experiment, you will see 4 shapes (circle, square, " +
            " diamond, triangle) appear on  the screen.</p><p>You must " +
            "choose only <strong>1</strong> of the 4 shapes displayed on the screen during each " +
            "trial.</p><p>Only <strong>1</strong> of the 4 shapes will lead to  " +
            "a positive outcome (a point being awarded).</p><p>Your goal is to " +
            "accumulate as many points as possible by the end of the trials.</p><p>If you " +
            "choose the shape on the <strong>far left</strong> of the screen, press <strong>'a'</strong> on the keyboard.</p><p>If " +
            "you choose the shape in the <strong>middle left</strong> of the screen, press <strong>'s'</strong> on the keyboard.</p><p>If " +
            "you choose the shape in the <strong>middle right</strong> of the screen, press <strong>'d'</strong> on the keyboard.</p><p>If " +
            "you choose the shape on the <strong>far right</strong> of the screen, press  <strong>'f'</strong> on the keyboard.</p>" +
            "<p>Press any key to begin.</p>",
        };

        var trial_p2_1 = {
            type: "4image-keyboard-response",
            stimulus1: 'img/Circle.png', 
            stimulus2: 'img/Triangle.png',
            stimulus3: 'img/Diamond.png',
            stimulus4: 'img/Square.png', 
            choices: ['a', 's', 'd', 'f'],
            repetitions: 5,
            randomize_order: true,

        };

        var finish = {
            type: "html-keyboard-response",
            stimulus: 'Thank you for taking part in the experiment.'
        }

        timeline.push(welcome);
        timeline.push(instructions1);
        timeline.push(fixation);
        timeline.push(trial_p1_1);
        timeline.push(point_accumulation1);
        timeline.push(point_accumulation2);
        timeline.push(fixation);
        timeline.push(trial_p1_2);
        timeline.push(point_accumulation1);
        timeline.push(point_accumulation2);
        timeline.push(fixation);
        timeline.push(trial_p1_3);
        timeline.push(point_accumulation1);
        timeline.push(point_accumulation2);
        timeline.push(fixation);
        timeline.push(trial_p1_4);
        timeline.push(point_accumulation1);
        timeline.push(point_accumulation2);
        timeline.push(fixation);
        timeline.push(trial_p1_5);
        timeline.push(point_accumulation1);
        timeline.push(point_accumulation2);
        timeline.push(fixation);
        timeline.push(trial_p1_6);
        timeline.push(point_accumulation1);
        timeline.push(point_accumulation2);
        timeline.push(debrief_block1);
        timeline.push(choice_question);
        timeline.push(question_block);
        timeline.push(instructions2);
        timeline.push(fixation);
        timeline.push(trial_p2_1);
        timeline.push(point_accumulation1);
        timeline.push(finish);

        jsPsych.init({
            timeline: timeline
        });
        
    </script>
</html>