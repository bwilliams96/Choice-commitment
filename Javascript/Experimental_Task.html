<!DOCTYPE html>
<html>
    <head>
        <title>Choice Commitment Task</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-custom/custom-jspsych-four-image-keyboard-response.js"></script>
        <script src="jspsych-custom/custom-jspsych-two-image-keyboard-response.js"></script>
        <link href="jspsych.6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

        var timeline = [];

        var welcome = {
            type: "html-button-response",
            stimulus: 'Welcome to the experiment.',
            choices: ['Begin']
        }

        var instructions = {
            type: "html-keyboard-response",
            stimulus: "<p>In this experiment, you will see shapes (circle, square, " +
            " diamond, triangle) appear on the screen randomly paired.</p><p>You must " +
            "choose only <strong>1</strong> of the 2 shapes displayed on the screen during each " +
            "trial.</p><p>Only <strong>1</strong> of the 2 shapes will lead to  " +
            "a positive outcome (a point being awarded).</p><p>Your goal is to " +
            "accumulate as many points as possible by the end of the trials.</p><p>If you " +
            "choose <strong>circle</strong>, press the letter 'c' on the keyboard.</p><p>If " +
            "you choose <strong>square</strong>, press the letter 's' on the keyboard.</p><p>If " +
            "you choose <strong>diamond</strong>, press the letter 'd' on the keyboard.</p><p>If " +
            "you choose <strong>triangle</strong>, press the letter 't' on the keyboard.</p>" +
            "<p>Press any key to begin.</p>",
        };
        
        var trial_1 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Circle.jpg', 
            stimulus2: 'img/Triangle.jpg',
            choices: ['c', 't']
        };

        var trial_2 = {
            type: "2image-keyboard-response",
            stimulus1: 'img/Triangle.png', 
            stimulus2: 'img/Diamond.png',
            choices: ['t', 'd']
        };

        var trial_3 = {
            type: "2image-keyboard-response",
            stimulus: 'img/Square.png, img/Diamond.png',
            choices: ['s', 'd']
        };

        var trial_4 = {
            type: "2image-keyboard-response",
            stimulus: 'img/Diamond.png, img/Circle.png',
            choices: ['d', 'c']
        };

        var trial_5 = {
            type: "2image-keyboard-response",
            stimulus: 'img/Triangle.png, img/Square.png',
            choices: ['t', 's']
        };

        var trial_6 = {
            type: "2image-keyboard-response",
            stimulus: 'img/Circle.png, img/Square.png',
            choices: ['c', 's']
        }

        var fixation = {
            type: "html-keyboard-response",
            stimulus: '<div style="font-size:60px;">+</div',
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000,
        }

        var test = {
            type: "2image-keyboard-response",
            stimulus: jsPsych.timelineVariable('stimulus'),
            choices: ['c', 't', 'd', 's']
        }
        
        //timeline1 = [trial_1, fixation, trial_2, fixation, trial_3, fixation, trial_4, fixation, trial_5, fixation, trial_6]

        var choice_question = {
            type: "html-keyboard-response",
            stimulus: "<p>Choose your preferred shape</p>" +
            "<div style='width: 700px;'>" +
            "<div style='float: left;'><img src='img/Shapes.png'></img>" +
            "</div>"+
            "<p>If you choose <strong>circle</strong>, press the letter 'c' on the keyboard.</p><p>If " +
            "you choose <strong>square</strong>, press the letter 's' on the keyboard.</p><p>If " +
            "you choose <strong>diamond</strong>, press the letter 'd' on the keyboard.</p><p>If " +
            "you choose <strong>triangle</strong>, press the letter 't' on the keyboard.</p>",
            choices: ['c', 't', 'd', 's']
        }

        var debrief_block = {
            type: "html-keyboard-response",
            stimulus: function() {

                var trials = jsPsych.data.get().filter({test_part: 'test'});
                var correct_trials = trials.filter({correct: true});
                var accuracy = Math.round(correct_trials.count() / trials.count() * 100);

                return "<p>You responded correctly on "+accuracy+"% of the trials.</p>"+
                "<p>Press any key to continue.</p>";         
            }
        }

        timeline.push(welcome);
        timeline.push(instructions);
        timeline.push(trial_1);
        timeline.push(fixation);
        timeline.push(choice_question);
        timeline.push(debrief_block);

        jsPsych.init({
            timeline: timeline
        });
    </script>
</html>